<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <title>Resultados</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f9;
            color: #333;
            padding: 20px;
            max-width: 1200px;
            margin: auto;
        }
        
        h2,
        h3,
        h4,
        h5 {
            color: #2c3e50;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            margin: 4px;
            transition: 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        img {
            width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            padding: 6px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .rank {
            width: 70%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fff;
            padding: 6px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 15px;
            background: #fff;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        th,
        td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #3498db;
            color: #fff;
        }
        
        tr:nth-child(even) {
            background: #f2f2f2;
        }
        /* Modal de hiperparâmetros */
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #fff;
            padding: 20px;
            width: 350px;
            border-radius: 8px;
            position: relative;
        }
        
        .modal pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 20px;
            color: #333;
        }
        /* Modal para imagens */
        
        .img-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .img-modal img {
            max-width: 90%;
            max-height: 90%;
            border: 4px solid #fff;
            border-radius: 8px;
        }
        
        .img-modal .close-img {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 30px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }
        
        pre.json-output {
            background: #fff;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
            max-height: 400px;
            overflow: auto;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        a {
            text-decoration: none;
            color: #3498db;
            font-weight: bold;
        }
        
        a:hover {
            color: #2980b9;
        }
    </style>
</head>

<body>
    <h2>Resultados do Pipeline</h2>

    <!-- Informações do Pipeline -->
    <div style="margin-bottom: 15px;">
        <strong>Número de blocos:</strong> {{ meta.params.bloco }} |
        <strong>Número de tentativas do Optuna:</strong> {{ meta.params.n_trials }}
    </div>

    <!-- Botões de hiperparâmetros por modelo -->
    <h3>Hiperparâmetros por modelo</h3>
    {% for model, info in resultados.items() %}
    <button onclick="document.getElementById('modal-{{ model }}').style.display='flex'">Ver {{ model }}</button>

    <!-- Modal de hiperparâmetros -->
    <div id="modal-{{ model }}" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="this.parentElement.parentElement.style.display='none'">&times;</span>
            <h4>{{ model }}</h4>
            <pre>{{ info.best_params | tojson(indent=2) }}</pre>
        </div>
    </div>
    {% endfor %}

    <!-- Ranking -->
    <h3>Ranking (por acurácia)</h3>
    <table>
        <thead>
            <tr>
                <th>Posição</th>
                <th>Modelo</th>
                <th>Acurácia</th>
            </tr>
        </thead>
        <tbody>
            {% for r in ranking %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ r.model }}</td>
                <td>{{ "%.4f"|format(r.accuracy) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Gráficos -->
    <h3>Gráficos</h3>

    <div style="display: flex;  flex-wrap: wrap; gap: 20px; justify-content: space-between;">

        <!-- PCA 2D -->
        <div style="flex: 1 1 45%; min-width: 400px;">
            <h4>PCA 2D</h4>
            <img src="{{ url_for('static', filename=meta.plots.pca_2d) }}" alt="PCA 2D" style="width: 100%; height: auto; border:1px solid #ddd; border-radius:8px;" onclick="openImgModal(this.src)">
        </div>

        <!-- PCA 3D -->
        <div style="flex: 1 1 50%; min-width: 500px; height: 700px;">
            <h4>PCA 3D Interativo</h4>
            <iframe src="{{ url_for('static', filename=meta.plots.pca_3d) }}" width="800px" height="600px" style="border:none; border-radius:8px;"></iframe>
        </div>

    </div>


    <div style="display: flex; flex-direction: column; align-items: center  ; justify-content: space-between;">
        <h4>Ranking de Acurácias</h4>
        <img class="rank" src="{{ url_for( 'static', filename=meta.plots.accuracies) }} " alt="Accuracies " width="800px" height="600px" onclick="openImgModal(this.src) ">
    </div>
    </div>

    <!-- Matrizes de confusão -->
    <h3>Matrizes de Confusão</h3>
    <div style="display:flex;gap:12px;flex-wrap:wrap ">
        {% for name, path in meta.plots.confusions.items() %}
        <div style="width:320px ">
            <h5>{{ name }}</h5>
            <img src="{{ url_for( 'static', filename=path) }} " alt="Confusion {{ name }} " onclick="openImgModal(this.src) ">
        </div>
        {% endfor %}
    </div>

    <!-- Modal para imagens -->
    <div id="imgModal " class="img-modal ">
        <span class="close-img " onclick="closeImgModal() ">&times;</span>
        <img id="modalImg " src=" ">
    </div>

    <!-- Relatórios JSON -->
    <h3>Relatórios (JSON)</h3>
    <pre class="json-output ">{{ resultados | tojson(indent=2) }}</pre>

    <p style="margin-top:20px "><a href="{{ url_for( 'index') }} ">← Voltar</a></p>

    <script>
        function openImgModal(src) {
            document.getElementById("imgModal ").style.display = "flex ";
            document.getElementById("modalImg ").src = src;
        }

        function closeImgModal() {
            document.getElementById("imgModal ").style.display = "none ";
        }
    </script>
</body>

</html>